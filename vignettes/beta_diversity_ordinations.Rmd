---
title: "HTSSIP: beta diversity ordinations"
author: "Nick Youngblut"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

# Beta diversity ordinations

## Dataset

First, let's load some packages including \code{HTSSIP}. 

```{r, message=FALSE, warning=FALSE}
library(dplyr)
library(ggplot2)
library(HTSSIP)
```

Also let's get an overview of the phyloseq object that we're going to use.

```{r, message=FALSE, warning=FALSE}
physeq_S2D2
```

## Parsing the dataset

See [HTSSIP introduction vignette](HTSSIP_intro.html) for a description on why dataset parsing is needed.

Let's the parameters for parsing the dataset into individual treatment-control comparisons. 

```{r}
params = get_treatment_params(physeq_S2D2, c('Substrate', 'Day'))
params
```

We just need the parameters for each treatment, so let's filter out the controls.
In this case, the controls are all '12C-Con'. 

```{r}
params = dplyr::filter(params, Substrate!='12C-Con')
```

Now, we will use an expression that will subset the phyloseq object into the comparisons that we want to make. 

\code{ex} is the expression that will be used for pruning the phyloseq object

```{r}
ex = "(Substrate=='12C-Con' & Day=='${Day}') | (Substrate=='${Substrate}' & Day == '${Day}')"
physeq_l = phyloseq_subset(physeq, params, ex)
physeq_l
```

## Calculating ordinations

Now, let's actually make ordinations of each treatment compared to the control. This will return a \code{data.frame} object for plotting. 

```{r, message=FALSE, warning=FALSE}
physeq_df = SIP_betaDiv_ord(physeq_l)
physeq_df %>% head(n=3)
```

Let's plot them. 

```{r, fig.height=4, fig.width=5, warning=FALSE}
phyloseq_ord_plot(physeq_df)
```




# Session info

```{r}
sessionInfo()
```
